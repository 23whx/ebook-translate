# eBook Translator 开发文档

> **项目定位**: 纯前端 EPUB 章节级 AI 翻译工具
> **核心属性**: 无后端、无存储、浏览器本地处理、人工最终确认

---

## 一、 项目目标 (Project Goal)
构建一个**纯前端 Web 应用**，实现以下全流程功能：
1. **上传**: 用户上传 EPUB 电子书。
2. **解析**: 以「章节级」拆解内容。
3. **初译**: 调用 Hugging Face Hosted Inference API，使用如https://huggingface.co/google/translategemma-4b-it 等专业模型。
4. **监督**: 调用 DeepSeek API“sk-d8fad050bff24a44a6fb030e1bb2032d” 作为“翻译一致性监督智能体”。需保证API安全性，防止泄露。
5. **审校**: 用户人工最终确认。
6. **导出**: 整合确认后的章节并下载新 EPUB。

⚠️ **关键约束**: 
- 零后端、零数据存储、零本地 GPU 依赖。
- 遵循“模型是助手，人类是最终裁决者”的原则。

---

## 二、 技术栈约束 (Hard Constraints)

| 维度 | 必须使用 (Required) | 禁止使用 (Forbidden) |
| :--- | :--- | :--- |
| **框架/样式** | React (函数组件), Tailwind CSS | Node.js 后端 |
| **API/通信** | 浏览器原生 API, Fetch API | 数据库, WebSocket |
| **存储** | 浏览器内存/本地缓存 | 服务器文件存储 |
| **模型** | 外部 LLM API (HF, DeepSeek) | 本地 GPU / 本地运行模型 |

---

## 三、 整体架构 (High-Level Architecture)



---

## 四、 核心设计理念 (Core Philosophy)
* **粒度控制**: 章节级处理，而非全文模糊翻译。
* **权限分级**: 模型不得直接覆盖用户确认的内容。
* **容错设计**: 失败是可恢复的，避免“一次网络波动导致全盘崩溃”。
* **一致性保障**: 通过“预设规则 + 智能体建议 + 人类确认”共同维护。

---

## 五、 功能模块拆分 (Modules)

### 1. 文件上传与解析
* **FileUploader**: 接收 `.epub` 文件（建议 < 5MB），纯本地校验。
* **EpubParser**: 
    * 依赖库：`epubjs`。
    * 输出结构：`Chapter { id, title, originalHtml, originalText }`。

### 2. 章节管理 (ChapterManager)
* **状态枚举**: `UNTRANSLATED`, `TRANSLATED`, `REVIEW_NEEDED`, `APPROVED`。
* **功能**: 显示章节列表，支持逐章进入翻译流程。

### 3. 翻译引擎 (TranslationEngine)
* **调用**: Hugging Face `google/translategemma-4b-it`。
* **Prompt 约束**: 忠实翻译、不润色、不总结、不解释。

### 4. 一致性监督智能体 (ConsistencyReviewer)
* **角色**: 审稿人（Reviewer），不生成新译文，只输出 JSON 格式的修改建议。
* **输入**: 当前译文 + 全局术语表 + 风格指南 + 前序章节摘要。
* **输出示例**:
    ```json
    {
      "status": "needs_revision",
      "issues": [{ "type": "terminology", "description": "术语不统一", "location": "第3段" }],
      "suggested_fixes": [{ "original": "...", "replace_with": "..." }]
    }
    ```

### 5. 人类审校界面 (Human Review UI)
* **交互**: 左右对照（原文/译文），高亮智能体建议，一键应用修正，手动编辑。

### 6. 全局术语表 (GlossaryManager)
* **逻辑**: 仅允许人工修改，作为后续章节翻译的“硬约束”传入模型。

### 7. EPUB 重建 (EpubBuilder)
* **逻辑**: 替换原文本，保留目录、结构与原始样式，触发浏览器下载。

---

## 六、 数据与状态管理 (State Management)
建议使用 **React Context** 或 **useReducer**。
```typescript
interface AppState {
  chapters: Chapter[];
  glossary: Record<string, string>; // { "source": "target" }
  currentChapterIndex: number;
  styleGuide: string;
}
```

---

## 七、 页面结构 (Pages)
首页: 项目说明、法律免责声明、文件上传入口。

章节列表页: 概览所有章节翻译进度。

章节翻译/审校页: 原文/译文对照、AI 建议列表、人工编辑区。

导出页: 汇总完成情况，提供 EPUB 下载。

---

### 八、 免责声明与边界 (Scope & Legal)
法律: 仅供个人学习研究，用户需自负版权责任。

边界: 不支持 PDF、不支持多人协作、刷新页面即数据清空。

---

### 九、 最终指令 (Meta Instruction)
请严格按照本开发文档实现前端代码。不要引入后端，所有业务逻辑必须在浏览器内完成。